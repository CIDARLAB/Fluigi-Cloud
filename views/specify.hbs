<!DOCTYPE html>
<html lang="en">

<head>

    <title> {{title}} </title>
    {{> favicon }}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- START: ALL PERSONAL JAVASCRIPTS HERE -->

    <script type="text/javascript">
        function terminalLog(string){
            SpecifyTerminal.echo(string);
        }
    </script>
    <!--<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script>
//        var SpecifyTerminal = null;
//        var socket = io();
//        socket.on('translate_console_readout', function(data){
//            //$('.translate_readout').append(data + '<br><br>');
//            terminalLog(data);
//        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js"></script>
    <script type="text/javascript" src="../javascripts/specifyDesign/actionCenterSupport.js"></script>

    <!--<script>-->
        <!--localStorage.specify_editor_state = 'specifyLFR';-->
        <!--localStorage.lfr_state = 'write';-->
        <!--localStorage.ucf_state = 'write';-->
    <!--</script>-->

    <!-- JAVASCRIPT DEPENDENCIES -->

    <!-- CSS DEPENDENCIES -->

    <!-- END: ALL PERSONAL JAVASCRIPTS HERE -->

    <!-- FILE PREVIEW SCRIPTS START -->
    <style type="text/css" media="screen">
        #editor_specify {
            height: 300px;
        }
    </style>
    <style type="text/css" media="screen">
        #editor_preview {
            height: 800px;
        }
    </style>
    <style type="text/css" media="screen">
        #editor_previewMMOutput {
            height: 600px;
        }
    </style>
    <style type="text/css">
        #myModal_translateCompleteComplete .modal-body
        {
            max-height: 1200px;
        }
    </style>

    <!--CDNS-->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/metisMenu/2.7.0/metisMenu.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/timelinejs/2.36.0/css/timeline.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/startbootstrap-sb-admin-2/3.3.7+1/css/sb-admin-2.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tour/0.10.1/css/bootstrap-tour.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tour/0.10.1/js/bootstrap-tour.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/jquery.terminal/1.0.14/css/jquery.terminal.css" rel="stylesheet">-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.terminal/1.0.14/js/jquery.terminal.js"></script>-->

    <!--Local files-->

    <script src="/javascripts/styles/jquery.min.js"></script>
    <script src="/javascripts/styles/bootstrap.min.js"></script>
    <script src="/javascripts/styles/metisMenu.min.js"></script>
    <script src="/javascripts/styles/raphael-min.js"></script>
    <script src="/javascripts/styles/morris.min.js"></script>
    <script src="/javascripts/styles/sb-admin-2.js"></script>
    <script type="text/javascript" src="../javascripts/specifyDesign/editorSupport.js"></script>
    <script type="test/javascript" src="../javascripts/specifyDesign/init_specify.js"></script>
    <script type="text/javascript" src="../javascripts/specifyDesign/fileNavigator.js"></script>
    <script src="/javascripts/common/knockout-3.4.2.js"></script>


    <script type="text/javascript">
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }
    </script>



    <style>
        body {  padding: 0 !important;  }
    </style>

    </head>

    <body>


    <!-- *** START: THIS DIVISION WRAPS EVERYTHING *** -->
    <div id="wrapper">

        <!-- START: THIS DIV HOSTS THE SIDE AND TOP NAVIGATION BARS -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">

            <!-- START: TOP LEFT HALF OF NAVIGATION BAR; WE CAN PUT OUR FLUIGI LOGOS HERE -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <img class="pull-left" height="40" width="40" style="margin-top: 5px; margin-left: 5px;" src="../images/NeptuneLogo.png">
                <a class="navbar-brand" style="font-family: 'Open Sans'"> NEPTUNE </a>
            </div>
            <!-- END: TOP LEFT HALF OF NAVIGATION BAR; WE CAN PUT OUR FLUIGI LOGOS HERE -->

            <!-- START: TOP RIGHT HALF OF NAVIGATION BAR; WE CAN PUT OUR LOGOUT, SETTINGS, ECT HERE -->
            <ul class="nav navbar-top-links navbar-right">


            </ul>
            <!-- END: TOP RIGHT HALF OF NAVIGATION BAR; WE CAN PUT OUR LOGOUT, SETTINGS, ECT HERE -->

            <!-- START: SIDE NAVIGATION BAR -->
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav" id="file_trees">
                    <ul class="nav" id="side-menu">
                        <li>
                            <a href="../"><i class="fa fa-home fa-fw"></i> Home </a>
                        </li>
                        <li id="1">
                            <a><i class="fa fa-external-link-square"></i> Workspaces: <span class="fa plus-square-o"></span></a>
                        </li>

                        {{> workspaceNavigationBar}}

                        <li id="1">
                            <a><i class="fa fa-folder-open"></i> Files in Workspace: <span class="fa plus-square-o"></span></a>
                        </li>

                        {{> fileNavigationBar}}

                        <li id="new_Proj">
                            <a href="#new_workspace" data-target="#new_workspace" data-toggle="modal"><i class="fa fa-plus-square"></i> New Project <span class="fa plus-square-o"></span></a>
                        </li>
                        <li id="new_File">
                            <a href="#new_file" data-target="#new_file" data-toggle="modal"><i class="fa fa-plus-square"></i> New File <span class="fa plus-square"></span></a>
                        </li>
                    </ul>
                </div>
                <!--<div class="sidebar-nav" id="workspace_tree">-->
                <!--</div>-->
            </div>
            <!-- END: SIDE NAVIGATION BAR -->

        </nav>
        <!-- END: THIS DIV HOSTS THE SIDE AND TOP NAVIGATION BARS -->

        <!-- START: PAGE WRAPER -->
        <div id="page-wrapper">

            <!-- PAGE TITLE START -->
            <div class="row">
                <div class="col-lg-12">
                    <h1></h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- PAGE TITLE END -->


            <!--PAGE CONTENT WRAP START: ALL PAGE CONTENT IS EMBEDDED BELOW -->
            <div class="row">


                <!-- START: LFR EDITOR & 2 other panels-->
                <div class="col-lg-8">

                    <!-- START: LFR EDITOR -->
                    <div class = "row"> <label id="filename" for="editor_specify">File Name: <span data-bind="text: currentFileName"/></label> </div>
                    <div class = "row"> <label id="workspacename" for="editor_specify">Workspace: <span data-bind="text: currentWorkSpaceName"/></label></div>
                    <div class="panel with-nav-tabs panel-default">
                        <div class="panel-heading">

                                    <div class="btn-group" role="group" aria-label="Basic example">
                                        <!--<button type="button" class="btn btn-success" data-bind="click: initEditor"> Start Editor </button>-->
                                        <button type="button" class="btn btn-secondary" onclick="save(EDITOR.editor,EDITOR.session)"> Save </button>
                                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#selectFile" onclick="togglelfr()"> Translate to MINT </button>
                                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#selectFile" onclick="togglemint()"> Compile to Schematic</button>
                                        <!--<button type="button" class="btn btn-secondary" id="filename"> </button>-->
                                        <!--<button type="button" class="btn btn-secondary" id="workspacename"> </button>-->
                                    </div>

                                    <script type="text/javascript">
                                function togglelfr(){
                                    localStorage.jobType = 'lfr';
                                }
                                function togglemint(){
                                    localStorage.jobType = 'mint';
                                }
                            </script>
                        </div>

                        <div class="panel-body" >
                            <div id="editor_specify" style="height:690px"></div>
                        </div>

                    </div>
                    <div class="text-center"></div>
                </div>

                <script src="/javascripts/ace/ace.js" type="text/javascript" charset="utf-8"></script>
                <!-- END: LFR EDITOR & 2 other panels-->

                <!-- START: UPLOAD FORM, UCF SUMMARY, INI SUMMARY -->
                <div class="col-lg-4">

                    <!-- START: TERMINAL -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-play fa-fw"></i> Terminal
                        </div>
                        <div class="panel-body">
                            <div id="terminal_specify"></div>
                        </div>
                    </div>
                    <!-- END: TERMINAL -->

                    <div class="panel panel-default">

                        <div class="panel-heading">
                            Actions
                        </div>

                        <div class="panel-body" id="ucf_maker" >
                            <div class="col-sm-6">
                                <button class="btn btn-primary" onclick="newFile('LFR')" >New LFR</button>

                                <div class="col-sm-12">

                                </div>

                                <span class="pull-left top-buffer">
                                <form class="form-inline" id="ucf_form">
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="new_file_name" placeholder="file name">
                                    </div>
                                </form>
                            </span>

                            </div>

                            <div class="col-sm-6">
                                <button class="btn btn-primary" onclick="newFile('UCF')" >New UCF</button>
                            </div>


                        </div>

                        <div class="panel-footer" id="footer">

                        </div>

                    </div>

                    <script type="text/javascript">
                        $("#ucf_form").submit(function(e){
                            e.preventDefault();
                        });
                        function deleteOp(op)
                        {
                            var oops = '#' + op;
                            $(oops).remove();
                        }
                    </script>
                    <!-- END: ACTION CENTER -->

                </div>


                <!-- END: UPLOAD FORM, UCF SUMMARY, INI SUMMARY -->

                <!-- ALL MODALS BELOW HERE -->
                <!-- FILE PREVIEW MODAL -->
                <div id="new_file" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header modal-header-primary">
                            <h4 class="modal-title">Enter your file name and type:</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="setfile_in">File name: </label>
                                <input type="text" class="form-control" id="setfile_in">
                            </div>
                            <div class="form-group">
                                <label for="setext_in">File type/extension: </label>
                                <input type="text" class="form-control" id="setext_in">
                            </div>
                            Please carefully enter the name and extension of your new file.
                            The file name can be anything.
                            The file extension must be input correctly, follow the example:
                                LFR: '.v'
                                UCF: '.json'
                                MINT:'.uf'
                                INI :'.ini'
                            Apologies for the awkward implementation. Soon to be improved :)
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal"> Cancel </button>
                            <button type="button" class="btn btn-default" data-dismiss="modal" onclick="newFile_cs(localStorage.WORKSPACE)"> Create File </button>
                        </div>
                        </div>
                    </div>
                </div>

                <div id="new_workspace" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header modal-header-primary">
                                <h4 class="modal-title">Create a new workspace:</h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label for="setwrk_in">Workspace name: </label>
                                    <input type="text" class="form-control" id="setwrk_in" data-bind="value : newWorkSpaceName">
                                </div>
                                Please enter the name of your new workspace. This workspace will be populated with
                                a single file that you can begin editing.
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal"> Cancel </button>
                                <button type="button" class="btn btn-default" data-dismiss="modal" data-bind="click: createNewWorkSpace"> Create Workspace </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="preview_dashboard" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title-prev modal-title" id="preview_title"></h4>
                            </div>

                            <div class="modal-body ace_preview_modal" id="editor_preview"></div>

                            <div class="modal-footer" id="previewModalFooter">

                            </div>
                        </div>
                    </div>
                </div>
                <script src="/javascripts/ace/ace.js" type="text/javascript" charset="utf-8"></script>
                <script> var editor_preview = ace.edit("editor_preview"); editor_preview.setTheme("ace/theme/crimson_editor");
                editor_preview.setOptions({
                    fontFamily: "monospace",
                    fontSize: "12pt"
                });</script>

                <div class="modal fade" id="preview_dashboard_img" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title-prev modal-title" id="preview_title_img"></h4>
                            </div>

                            <div class="modal-body ace_preview_modal" id="img_here">

                            </div>

                            <div class="modal-footer" id="previewModalFooter_img">

                            </div>
                        </div>
                    </div>
                </div>

                <div id='name_outputMINT' class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">

                        <div class="modal-content">

                            <div class="modal- modal-header-primary">
                                <h4 class="modal-title">Choose output MINT file name: </h4>
                            </div>

                            <div class="modal-body" id="project_select">
                                <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn btn-primary" type="button" onclick="translateLFR(document.getElementById('outputMINTname').value)">Translate LFR</button>
                    </span>
                                    <input id='outputMINTname' type="text" class="form-control" placeholder="MINT_result">
                                </div>
                            </div>

                            <div class="modal-footer">
                                <p>You are about to compile your LFR into a MINT file.</p>
                                <p>Please enter the name of your output MINT file.</p>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Modal: Translate Actions -->
                <div class="modal fade" id="myModal_translateComplete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header modal-header-primary">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="hideProceed()">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabel"> Translation successful: MINT Output Preview </h4>
                            </div>

                            <div class="modal-body" id="editor_previewMMOutput">

                            </div>
                            <div class="modal-footer">

                                <a>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="hideProceed()">
                                        Close
                                    </button>
                                </a>
                                <div class="row"><br>
                                    <a href="../design">
                                        <button type="button" class="btn btn-primary btn-lg center-block" id="proceedDesign" onclick="hideProceed()">
                                            Proceed to Design Stage
                                        </button>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script src="/javascripts/ace/ace.js" type="text/javascript" charset="utf-8"></script>
                <script> var editor_previewMMOutput = ace.edit("editor_previewMMOutput"); editor_previewMMOutput.setTheme("ace/theme/crimson_editor");
                editor_previewMMOutput.setOptions({
                    fontFamily: "monospace",
                    fontSize: "12pt"
                });</script>

            </div>

            <!--PAGE CONTENT WRAP END: ALL PAGE CONTENT IS EMBEDDED ABOVE -->
        </div>
        <!-- END: PAGE WRAPER -->
    </div>
    <!-- *** END: THIS DIVISION WRAPS EVERYTHING *** -->

    <script type="text/javascript">
        function hideProceed() {$("#proceedDesign").hide();}
        //hideProceed();
    </script>


    </body>

<script src="/javascripts/styles/jquery.terminal-0.10.12.min.js"></script>
<script src="/javascripts/styles/jquery.mousewheel.min.js"></script>
<link href="/javascripts/styles/jquery.terminal-0.10.12.min.css" rel="stylesheet"/>

    <script type="text/javascript">
        $(document).ready(function() {
            SpecifyTerminal = $('#terminal_specify').terminal(function(command, term) {
                if (command !== '') {
                    try {
                        var result = window.eval(command);
                        if (result !== undefined) {
                            term.echo(new String(result));
                        }
                    } catch(e) {
                        term.error(new String(e));
                    }
                } else {
                }
            }, {
                greetings: 'Fluigi Translator',
                name: 'terminal_specify',
                height: 400,
                prompt: 'μF> '
            });
        });
    </script>

    <script type="text/javascript">
//        function template_UCF_UI()
//        {
//            $.get('../hbsPartials/ucf_template.hbs', function (data) {
//                var template = Handlebars.compile(data);
//                $.post('/api/getFile', {path: localStorage.UCF}, function (data) {
//                    var myhtml = template(JSON.parse(data));
//                    $("#ucf_maker").html(myhtml);
//                });
//            }, 'html');
//        }
//        $(document).ready(template_UCF_UI);
        //template_UCF_UI();
    </script>



    <div id='renameLFR' class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="input-group">
                <span class="input-group-btn">
                    <button class="btn btn-secondary" type="button" onclick="renameFile()">Rename LFR</button>
                </span>
                    <input id='fileNameInput_lfr' type="text" class="form-control" placeholder="">
                </div>
            </div>
        </div>
    </div>
    <div id='renameUCF' class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="input-group">
                <span class="input-group-btn">
                    <button class="btn btn-secondary" type="button" onclick="renameFile()">Rename UCF</button>
                </span>
                    <input id='fileNameInput_ucf' type="text" class="form-control" placeholder="">
                </div>
            </div>
        </div>
    </div>
    <div id='name_operator' class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">

            <div class="modal-content">
                <div class="input-group">
                <span class="input-group-btn">
                    <button class="btn btn-secondary" data-dismiss="modal" type="button" onclick="generateUCF_UI()">Create Operator</button>
                </span>
                    <input id='operator_symbol_in' type="text" class="form-control" placeholder="Enter Operator Symbol">
                    <input id='operator_name_in' type="text" class="form-control" placeholder="Enter Operator Name">
                </div>
            </div>
        </div>
    </div>
    </html>

    <style type="text/css">

        .top-buffer { margin-top:20px; }

        .modal-header-success {
            color:#fff;
            padding:9px 15px;
            border-bottom:1px solid #eee;
            background-color: #5cb85c;
            -webkit-border-top-left-radius: 5px;
            -webkit-border-top-right-radius: 5px;
            -moz-border-radius-topleft: 5px;
            -moz-border-radius-topright: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .modal-header-warning {
            color:#fff;
            padding:9px 15px;
            border-bottom:1px solid #eee;
            background-color: #f0ad4e;
            -webkit-border-top-left-radius: 5px;
            -webkit-border-top-right-radius: 5px;
            -moz-border-radius-topleft: 5px;
            -moz-border-radius-topright: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .modal-header-danger {
            color:#fff;
            padding:9px 15px;
            border-bottom:1px solid #eee;
            background-color: #d9534f;
            -webkit-border-top-left-radius: 5px;
            -webkit-border-top-right-radius: 5px;
            -moz-border-radius-topleft: 5px;
            -moz-border-radius-topright: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .modal-header-info {
            color:#fff;
            padding:9px 15px;
            border-bottom:1px solid #eee;
            background-color: #5bc0de;
            -webkit-border-top-left-radius: 5px;
            -webkit-border-top-right-radius: 5px;
            -moz-border-radius-topleft: 5px;
            -moz-border-radius-topright: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .modal-header-primary {
            color:#fff;
            padding:9px 15px;
            border-bottom:1px solid #eee;
            background-color: #428bca;
            -webkit-border-top-left-radius: 5px;
            -webkit-border-top-right-radius: 5px;
            -moz-border-radius-topleft: 5px;
            -moz-border-radius-topright: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .modal-header-custom-blue {
            padding:9px 15px;
            border-bottom:1px solid #eee;
            background-color: #0480be;
            -webkit-border-top-left-radius: 5px;
            -webkit-border-top-right-radius: 5px;
            -moz-border-radius-topleft: 5px;
            -moz-border-radius-topright: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
    </style>

<div id="compileModal" >
    {{> jobSelector}}
</div>
<label data-bind="text: currentWorkSpace.name"/>
<label data-bind="text: currentFile.name"/>
<ul data-bind="foreach: { data: files, as: 'id'}">
    <li data-bind="text: name"></li>
</ul>

<script type="text/javascript">
    //This is the knockout viewmodel for the page

    function WorkspaceItemModel(name, id, ext){
        var self = this;

        self.name = name;
        self.id = id;
        self.ext = ext;

    }

    function FileItemModel(name, id , ext , link){
        var self = this;

        self.name = name;
        self.id = id;
        self.ext = ext;
        self.link = link;


    }

    function EditorViewModel(){
        var self = this;

        self.editorObject;

        self.newWorkSpaceName = ko.observable("");

        self.workSpaceIDs = ko.observableArray([]);

        self.workSpaces = ko.observableArray([]);

        //self.editorText = ko.observable("");

        self.currentFile=  ko.observable("");

        self.currentWorkSpace =  ko.observable("");

        //TODO: Clean up the number of fields that are being used

        self.currentWorkSpaceName = ko.observable("");
        self.currentFileName = ko.observable("");

        self.files = ko.observableArray([]);

        self.createNewWorkSpace = function(){

            var workspace_name = self.newWorkSpaceName();
            $.post('/api/v1/workspace',
                    {
                        name: workspace_name
                    },
                    function(workspace_id)
                    {
                        console.log("Created Workspace: " + workspace_id);
                        self.updateWorkSpaces();
                        //TODO update the user and workspace models
                        self.setAsCurrentWorkSpace(workspace_id);
                    }
            );
        }

        self.updateWorkSpaces = function(){
            console.log("Getting all the new workspaces :"  );
            $.get('api/v1/workspaces',function (response) {
                self.workSpaceIDs.removeAll();
                self.workSpaces.removeAll();
                for(var i = 0 ; i<response.length;i++){
                    self.addWorkSpace(response[i]);
                    self.workSpaceIDs.push(response[i]);
                }
                console.log(self.workSpaceIDs());
            })
        }

        self.addFile = function(id){
            //TODO: get the file object
            $.get('/api/v1/file', {id:id}, function(response){
                console.log(response);
                self.files.push(new FileItemModel(response.name, response.id , response.ext, response.link));
            });
        }

        self.updateFiles = function(){
            var workspace = self.currentWorkSpace();
            console.log("Getting all the files in this workspace" + workspace);
            self.files.removeAll();
            $.get('/api/v1/files', {id: workspace.id}, function (response) {
                //TODO: call add file for each
                console.log(response);
                for(var i = 0; i<response.length; i++){
                    self.addFile(response[i]);
                }
            });
        }

        self.addWorkSpace = function (id) {
            $.getJSON('/api/v1/workspace', {workspace_id:id}, function (workspace) {
                //if(err) console.log(err);
                console.log(workspace);
                self.workSpaces.push(new WorkspaceItemModel(workspace.name, workspace.id));
            });
        }

        self.setAsCurrentWorkSpace = function(workspace){
            //TODO -  find the correct workspace and set it to the current workspace
            self.currentWorkSpace(workspace);
            self.currentWorkSpaceName(workspace.name);
            self.updateFiles();
        }

        self.setAsCurrentFile = function(file){
            self.currentFile(file);
            self.currentFileName(file.name);
            self.loadFile(file.link , file.ext)
        }


        self.loadFile = function(link, ext){
            if(link == null){
                console.error("Link for loading the file is null");
                return;
            }
            switch(ext) {
                case ".svg":
                    //TODO: How to load the SVG ?
                    break;
                case ".eps":
                    //TODO: How to load the EPS ?
                    break;
                default:
                    //TODO: Load the text file
                    //self.editorText();
                    $.get(link, function(data){
                        //TODO: Load this into ace
                        console.log(data);
                        self.editorObject.session.setValue(data);
                    });
            }
        }

        self.saveFile = function(text){
            //TODO: Send the put command
        }

        self.compileLFR = function(fileid){
            //TODO: Send file id that has to be compiled.
        }

        self.compileMINT = function(fileid){
            //TODO: Send file id that has to be compiled
        }

        self.initEditor = function(){
            //TODO: Make the sessions more atomic keeping track of each of the files that being edited.

            ////Initializing the editor//////
            var editor_specify = ace.edit("editor_specify");
            editor_specify.setTheme("ace/theme/crimson_editor");
            editor_specify.setOptions({
                fontFamily: "monospace",
                fontSize: "12pt"
            });
            var MainSession = ace.createEditSession('MainSession', "ace/mode/verilog");
            editor_specify.setSession(MainSession);

            self.editorObject = {editor: editor_specify, session: MainSession};

        }

        self.initPage = function(){
            self.updateWorkSpaces();
            self.initEditor();
        }
    }

    var editorViewModel = new EditorViewModel();
    ko.applyBindings(editorViewModel);

    editorViewModel.initPage();
</script>